language: node_js
#long term servicing version
node_js:
  - lts/*
# ubuntu 18.04 bionic
dist: bionic
env:
  global:
    #enable firefox headless mode for faster automated UI testing
    - MOZ_HEADLESS=1
addons:
  #installs firefox
  firefox: latest
  #installs sonarcloud
  sonarcloud:
    organization: 'dublo144'
    token:
      secure: 'A9nECSplQwzy9f9dJNLc+7aNqUCbwQGCh1opuDiqmehSO/1r4YDIkIMhxGxKiru0fmypOvmOw+vqOj3K8GxyB93Br3fJq+rcBKKhVt8vV4CLR5GPNn10W6VbU/ZUGZyX/fZYHilYdPCpgzdOOKAcWgJANnGvynzQx3syNK/wf4hN8fW5L+iKPKEzcTyQ0J4K2FyuU47dDTnUXElea5YehR6bLuKO+yfmF33Lr6OSKtwQOCKMWEd0dF6GUirrNF43GFP3Si+HpXouBWEYD2st+GO3cIFy/9Z3v3CDJ3E05avRKieFx90xutAE1uM99NknKSRzOPP+IBM5xAmjnBddKHP2xCtmjnZJZr3ycpn3TEYfb37RmC9Se+H0x3nOvCVzWDjJYVnPImFP+8V/73TKyh0hsBRQZurfua8vf+rYPf7NEWT4b3l6uYMNPW1H+p/ARyKxqhvcc3aq3LsCTnMT3zxsMTlQwwkBb8hf55e9QcRyscHnlCWNsVEmW0kGRdrXBUeYwzXHSUHj5r8A191bGqGCF8y4xsjIzYd/5/fb5T1Xu78HiwNkJhkM5OQi+m0qrDIBBZAW2YGI0swYZE6Qp+/FUJLe8NcRa6Nne7vWjtSYgZcSHQdfhM2I0849rI6u7H9mi+A05DgY0PIbTUyX+lHJmy0RRY1QGNSpKml3Fh8='
  apt:
    packages:
      #Cypress dependency on linux
      - libgconf-2-4
cache:
  directories:
    #Cypress cache
    - '~/.cache'
install:
  #Like npm install but used in automated environments to make sure it does a clean install of dependencies and it can be significantly faster. (you must have a package-lock.json)
  - npm ci

script:
  #start and wait for webpack dev server
  - npm run start:ci & wait-on http://localhost:3000
  #automated UI tests which records testing to cypress dashboard
  # - npm run cy:ci:test
  #sonar analyze code from repo and coverage from cypress
  - sonar-scanner
  - npm run build
  #Deploy will only run on master branch. Deploys to surge - must have provided login details on travis-org/travis.com for this to work.
deploy:
  provider: surge
  project: './build/'
  domain: https://madsbrandt-frontendstarter.surge.sh
  skip_cleanup: true
